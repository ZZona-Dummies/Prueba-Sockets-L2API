Í
ZD:\VISUAL STUDIO\Visual Studio Projects\Prueba-Sockets-L2API\Dummy-Socket\Configuration.cs
	namespace 	
Dummy_Socket
 
{ 
public 

class 
Configuration 
{ 
public 
int 
clientInstances "
=# $
$num% &
,& '
serverInstances "
=# $
$num% &
;& '
public

 
bool

 
startClient

 
,

  
startServer 
;  
public 
static 
string 

configFile '
=( )
Path* .
.. /
Combine/ 6
(6 7
Program7 >
.> ?
	AppFolder? H
,H I
$strJ \
)\ ]
;] ^
public 
static 
Configuration #
Load$ (
(( )
)) *
{ 	
Configuration 
ins 
= 
File  $
.$ %
Exists% +
(+ ,

configFile, 6
)6 7
?8 9
JSONHandler: E
.E F
DeserializeFromFileF Y
<Y Z
ConfigurationZ g
>g h
(h i

configFilei s
)s t
:u v
nullw {
;{ |
if 
( 
ins 
!= 
null 
) 
return 
ins 
; 
return 
new 
Configuration $
($ %
)% &
;& '
} 	
public 
static 
void 
Save 
(  
Configuration  -
ins. 1
)1 2
{ 	
JSONHandler 
. 
SerializeToFile '
(' (

configFile( 2
,2 3
ins4 7
)7 8
;8 9
} 	
} 
} ã0
TD:\VISUAL STUDIO\Visual Studio Projects\Prueba-Sockets-L2API\Dummy-Socket\frmMain.cs
	namespace 	
Dummy_Socket
 
{ 
public 

partial 
class 
frmMain  
:! "
EnhancedForm# /
</ 0
frmMain0 7
>7 8
{ 
private 

frmOptions 
optionsForm &
{ 	
get 
{ 
return 

frmOptions !
.! "
Me" $
;$ %
} 
} 	
public   
static   

Dictionary    
<    !
int  ! $
,  $ %
SocketInstance  & 4
>  4 5
	socketIns  6 ?
=  @ A
new  B E

Dictionary  F P
<  P Q
int  Q T
,  T U
SocketInstance  V d
>  d e
(  e f
)  f g
;  g h
public!! 
static!! 
int!! 
lastID!!  
=!!! "
-!!# $
$num!!$ %
;!!% &
public## 
frmMain## 
(## 
)## 
{$$ 	
InitializeComponent%% 
(%%  
)%%  !
;%%! "
}&& 	
private(( 
void(( 
button1_Click(( "
(((" #
object((# )
sender((* 0
,((0 1
	EventArgs((2 ;
e((< =
)((= >
{)) 	
	frmSocket-- 

socketForm--  
=--! "
new--# &
	frmSocket--' 0
(--0 1
)--1 2
;--2 3

socketForm.. 
... 
Show.. 
(.. 
).. 
;.. 

socketForm// 
.// 
ShowServerTab// $
(//$ %
)//% &
;//& '
}00 	
private22 
void22 
button2_Click22 "
(22" #
object22# )
sender22* 0
,220 1
	EventArgs222 ;
e22< =
)22= >
{33 	
	frmSocket44 

socketForm44  
=44! "
new44# &
	frmSocket44' 0
(440 1
)441 2
;442 3

socketForm55 
.55 
Show55 
(55 
)55 
;55 

socketForm66 
.66 
ShowClientTab66 $
(66$ %
)66% &
;66& '
}77 	
private99 
void99 
button3_Click99 "
(99" #
object99# )
sender99* 0
,990 1
	EventArgs992 ;
e99< =
)99= >
{:: 	
ExecuteInstance;; 
(;; 
true;;  
,;;  !
true;;" &
);;& '
;;;' (
}<< 	
private>> 
void>> 
ExecuteInstance>> $
(>>$ %
bool>>% )
	serverIns>>* 3
,>>3 4
bool>>5 9
	clientIns>>: C
)>>C D
{?? 	
if@@ 
(@@ 
	clientIns@@ 
||@@ 
	serverIns@@ &
)@@& '
{AA 
intBB 
cinBB 
=BB 
cfgBB 
.BB 
clientInstancesBB -
,BB- .
sinCC 
=CC 
cfgCC 
.CC 
serverInstancesCC -
;CC- .
ifEE 
(EE 
	serverInsEE 
)EE 
forFF 
(FF 
intFF 
iFF 
=FF  
$numFF! "
;FF" #
iFF$ %
<FF& '
sinFF( +
;FF+ ,
++FF- /
iFF/ 0
)FF0 1
{GG 
	frmSocketHH !
soHH" $
=HH% &
	frmSocketHH' 0
.HH0 1
MeHH1 3
.HH3 4
CreateInstanceHH4 B
<HHB C
	frmSocketHHC L
>HHL M
(HHM N
)HHN O
;HHO P
soII 
.II 
ShowII 
(II  
)II  !
;II! "
soJJ 
.JJ 
ShowServerTabJJ (
(JJ( )
)JJ) *
;JJ* +
soKK 
.KK 
StartKK  
(KK  !
falseKK! &
)KK& '
;KK' (
}LL 
ifNN 
(NN 
	clientInsNN 
)NN 
forOO 
(OO 
intOO 
iOO 
=OO  
$numOO! "
;OO" #
iOO$ %
<OO& '
cinOO( +
;OO+ ,
++OO- /
iOO/ 0
)OO0 1
{PP 
	frmSocketQQ !
soQQ" $
=QQ% &
	frmSocketQQ' 0
.QQ0 1
MeQQ1 3
.QQ3 4
CreateInstanceQQ4 B
<QQB C
	frmSocketQQC L
>QQL M
(QQM N
)QQN O
;QQO P
soRR 
.RR 
disableAutoNameRR *
=RR+ ,
trueRR- 1
;RR1 2
soSS 
.SS 
ShowSS 
(SS  
)SS  !
;SS! "
soTT 
.TT 
ShowClientTabTT (
(TT( )
)TT) *
;TT* +
soUU 
.UU 
SetNameUU "
(UU" #
$strUU# +
+UU, -
iUU. /
)UU/ 0
;UU0 1
soVV 
.VV 
StartVV  
(VV  !
trueVV! %
)VV% &
;VV& '
}WW 
}XX 
}YY 	
private[[ 
void[[ +
opcionesToolStripMenuItem_Click[[ 4
([[4 5
object[[5 ;
sender[[< B
,[[B C
	EventArgs[[D M
e[[N O
)[[O P
{\\ 	
optionsForm]] 
.]] 
Show]] 
(]] 
)]] 
;]] 
}^^ 	
private`` 
void`` 
frmMain_Load`` !
(``! "
object``" (
sender``) /
,``/ 0
	EventArgs``1 :
e``; <
)``< =
{aa 	
ExecuteInstancebb 
(bb 
cfgbb 
.bb  
startServerbb  +
,bb+ ,
cfgbb- 0
.bb0 1
startClientbb1 <
)bb< =
;bb= >
}cc 	
}dd 
}ee ˚
WD:\VISUAL STUDIO\Visual Studio Projects\Prueba-Sockets-L2API\Dummy-Socket\frmOptions.cs
	namespace 	
Dummy_Socket
 
{ 
public 

partial 
class 

frmOptions #
:$ %
EnhancedForm& 2
<2 3

frmOptions3 =
>= >
{ 
private 
static 
Configuration $
_config% ,
;, -
public 
static 
Configuration #
config$ *
{ 	
get 
{ 
if 
( 
_config 
== 
null #
)# $
_config 
= 
Configuration +
.+ ,
Load, 0
(0 1
)1 2
;2 3
return 
_config 
; 
} 
} 	
public 

frmOptions 
( 
) 
{ 	
InitializeComponent 
(  
)  !
;! "
} 	
private 
void 
frmOptions_Load $
($ %
object% +
sender, 2
,2 3
	EventArgs4 =
e> ?
)? @
{   	
numericUpDown1!! 
.!! 
Value!!  
=!!! "
_config!!# *
.!!* +
clientInstances!!+ :
;!!: ;
numericUpDown2"" 
."" 
Value""  
=""! "
_config""# *
.""* +
serverInstances""+ :
;"": ;
	checkBox1## 
.## 
Checked## 
=## 
_config##  '
.##' (
startClient##( 3
;##3 4
	checkBox2$$ 
.$$ 
Checked$$ 
=$$ 
_config$$  '
.$$' (
startServer$$( 3
;$$3 4
}%% 	
private'' 
void'' 
button1_Click'' "
(''" #
object''# )
sender''* 0
,''0 1
	EventArgs''2 ;
e''< =
)''= >
{(( 	
Configuration)) 
.)) 
Save)) 
()) 
_config)) &
)))& '
;))' (
}** 	
}++ 
},, Œv
VD:\VISUAL STUDIO\Visual Studio Projects\Prueba-Sockets-L2API\Dummy-Socket\frmSocket.cs
	namespace 	
Dummy_Socket
 
{ 
public		 

enum		 
SocketState		 
{		 

NotStarted		 (
,		( )
ClientStarted		* 7
,		7 8
ServerStarted		9 F
}		G H
public 

partial 
class 
	frmSocket "
:# $
EnhancedForm% 1
<1 2
	frmSocket2 ;
>; <
{ 
public 
SocketClient 
client "
;" #
public 
SocketServer 
server "
;" #
public 
bool 
disableAutoName #
;# $
public 
int 
socketID 
; 
private 
SocketState 
_state "
;" #
public 
SocketState 
state  
{ 	
get 
{ 
return 
_state 
; 
} 
set 
{ 
SocketState 
oldstate $
=% &
_state' -
;- .
_state 
= 
value 
; 
if   
(   
_state   
==   
SocketState   )
.  ) *
ClientStarted  * 7
)  7 8
{!! 
clientConnect"" !
.""! "
Text""" &
=""' (
$str"") 6
;""6 7
DisableControls## #
(### $
false##$ )
)##) *
;##* +
}$$ 
else%% 
if%% 
(%% 
_state%% 
==%%  "
SocketState%%# .
.%%. /
ServerStarted%%/ <
)%%< =
{&& 
startServer'' 
.''  
Text''  $
=''% &
$str''' ;
;''; <
DisableControls(( #
(((# $
true(($ (
)((( )
;(() *
})) 
else** 
{++ 
if,, 
(,, 
oldstate,,  
==,,! #
SocketState,,$ /
.,,/ 0
ClientStarted,,0 =
),,= >
{-- 
clientConnect.. %
...% &
Text..& *
=..+ ,
$str..- 9
;..9 :
EnableControls// &
(//& '
true//' +
)//+ ,
;//, -
}00 
else11 
if11 
(11 
oldstate11 %
==11& (
SocketState11) 4
.114 5
ServerStarted115 B
)11B C
{22 
startServer33 #
.33# $
Text33$ (
=33) *
$str33+ >
;33> ?
EnableControls44 &
(44& '
false44' ,
)44, -
;44- .
}55 
}66 
}77 
}88 	
public:: 
const:: 
string:: 
notValidClientConn:: .
=::/ 0
$str	::1 Ñ
,
::Ñ Ö
notValidServerConn;; .
=;;/ 0
$str	;;1 Ü
;
;;Ü á
public== 
	frmSocket== 
(== 
)== 
{>> 	
InitializeComponent?? 
(??  
)??  !
;??! "
}@@ 	
privateBB 
voidBB 
frmSocket_LoadBB #
(BB# $
objectBB$ *
senderBB+ 1
,BB1 2
	EventArgsBB3 <
eBB= >
)BB> ?
{CC 	
ifDD 
(DD 
!DD 
disableAutoNameDD  
)DD  !

clientNameEE 
.EE 
TextEE 
=EE  !
stringEE" (
.EE( )
FormatEE) /
(EE/ 0
$strEE0 ;
,EE; <
newEE= @
RandomEEA G
(EEG H
)EEH I
.EEI J
NextEEJ N
(EEN O
$numEEO P
,EEP Q
$numEER V
)EEV W
)EEW X
;EEX Y
}FF 	
publicHH 
voidHH 
ShowServerTabHH !
(HH! "
)HH" #
{II 	
ifJJ 
(JJ 
tabControl1JJ 
.JJ 
SelectedTabJJ '
!=JJ( *
tabPage1JJ+ 3
)JJ3 4
tabControl1KK 
.KK 
SelectedTabKK '
=KK( )
tabPage1KK* 2
;KK2 3
}LL 	
publicNN 
voidNN 
ShowClientTabNN !
(NN! "
)NN" #
{OO 	
ifPP 
(PP 
tabControl1PP 
.PP 
SelectedTabPP '
!=PP( *
tabPage2PP+ 3
)PP3 4
tabControl1QQ 
.QQ 
SelectedTabQQ '
=QQ( )
tabPage2QQ* 2
;QQ2 3
}RR 	
publicTT 
voidTT 
StartTT 
(TT 
boolTT 
isClientTT '
)TT' (
{UU 	
boolVV 
succVV 
=VV 
falseVV 
;VV 
socketIDWW 
=WW 
++WW 
frmMainWW  
.WW  !
lastIDWW! '
;WW' (
ifXX 
(XX 
isClientXX 
)XX 
{YY 
ifZZ 
(ZZ 
clientZZ 
==ZZ 
nullZZ "
)ZZ" #
{[[ 
if\\ 
(\\ 
ValidateClient\\ &
(\\& '
)\\' (
)\\( )
{]] 
client^^ 
=^^  
new^^! $
SocketClient^^% 1
(^^1 2
clientIP^^2 :
.^^: ;
Text^^; ?
,^^? @
(^^A B
int^^B E
)^^E F

clientPort^^G Q
.^^Q R
Value^^R W
,^^W X
ClientAction^^Y e
(^^e f
)^^f g
)^^g h
;^^h i
client__ 
.__ 
myLogger__ '
=__( )
new__* -
SocketClientConsole__. A
(__A B
receivedMsgs__B N
,__N O
false__P U
)__U V
;__V W
client`` 
.`` 
DoConnection`` +
(``+ ,
)``, -
;``- .
succbb 
=bb 
truebb #
;bb# $
}cc 
elsedd 
clientee 
.ee 
myLoggeree '
.ee' (
LogErroree( 0
(ee0 1
notValidClientConnee1 C
)eeC D
;eeD E
}ff 
}gg 
elsehh 
{ii 
ifjj 
(jj 
ValidateServerjj "
(jj" #
)jj# $
)jj$ %
{kk 
serverll 
=ll 
newll  
SocketServerll! -
(ll- .
newll. 1
SocketPermissionll2 B
(llB C
NetworkAccessllC P
.llP Q
AcceptllQ W
,llW X
TransportTypellY f
.llf g
Tcpllg j
,llj k
$strlll n
,lln o
SocketPermission	llp Ä
.
llÄ Å
AllPorts
llÅ â
)
llâ ä
,
llä ã
	IPAddress
llå ï
.
llï ñ
Parse
llñ õ
(
llõ ú
serverIP
llú §
.
ll§ •
Text
ll• ©
)
ll© ™
,
ll™ ´
(
ll¨ ≠
int
ll≠ ∞
)
ll∞ ±

serverPort
ll≤ º
.
llº Ω
Value
llΩ ¬
,
ll¬ √

SocketType
llƒ Œ
.
llŒ œ
Stream
llœ ’
,
ll’ ÷
ProtocolType
ll◊ „
.
ll„ ‰
Tcp
ll‰ Á
,
llÁ Ë
true
llÈ Ì
)
llÌ Ó
;
llÓ Ô
servermm 
.mm 
myLoggermm #
=mm$ %
newmm& )
SocketServerConsolemm* =
(mm= >
	serverLogmm> G
)mmG H
;mmH I
servernn 
.nn 
	ComeAlivenn $
(nn$ %
)nn% &
;nn& '
succpp 
=pp 
truepp 
;pp  
}qq 
elserr 
clientss 
.ss 
myLoggerss #
.ss# $
LogErrorss$ ,
(ss, -
notValidServerConnss- ?
)ss? @
;ss@ A
}tt 
ifuu 
(uu 
succuu 
)uu 
{vv 
stateww 
=ww 
isClientww  
?ww! "
SocketStateww# .
.ww. /
ClientStartedww/ <
:ww= >
SocketStateww? J
.wwJ K
ServerStartedwwK X
;wwX Y
frmMainxx 
.xx 
	socketInsxx !
.xx! "
Addxx" %
(xx% &
socketIDxx& .
,xx. /
newxx0 3
SocketInstancexx4 B
(xxB C
thisxxC G
,xxG H
isClientxxI Q
)xxQ R
)xxR S
;xxS T
}yy 
}zz 	
private|| 
Action|| 
ClientAction|| #
(||# $
)||$ %
{}} 	
return~~ 
(~~ 
)~~ 
=>~~ 
{ 
byte
ÄÄ 
[
ÄÄ 
]
ÄÄ 
bytes
ÄÄ 
=
ÄÄ 
new
ÄÄ "
byte
ÄÄ# '
[
ÄÄ' (
$num
ÄÄ( ,
]
ÄÄ, -
;
ÄÄ- .
SocketMessage
ÇÇ 
sm
ÇÇ  
=
ÇÇ! "
null
ÇÇ# '
;
ÇÇ' (
if
ÉÉ 
(
ÉÉ 
client
ÉÉ 
.
ÉÉ 
ReceiveData
ÉÉ &
(
ÉÉ& '
out
ÉÉ' *
sm
ÉÉ+ -
)
ÉÉ- .
)
ÉÉ. /
Console
ÑÑ 
.
ÑÑ 
	WriteLine
ÑÑ %
(
ÑÑ% &
$str
ÑÑ& R
,
ÑÑR S
client
ÑÑT Z
.
ÑÑZ [
Id
ÑÑ[ ]
,
ÑÑ] ^
sm
ÑÑ_ a
.
ÑÑa b
id
ÑÑb d
,
ÑÑd e
sm
ÑÑf h
.
ÑÑh i
msg
ÑÑi l
)
ÑÑl m
;
ÑÑm n
else
ÖÖ 
Console
ÜÜ 
.
ÜÜ 
	WriteLine
ÜÜ %
(
ÜÜ% &
$str
ÜÜ& =
)
ÜÜ= >
;
ÜÜ> ?
if
àà 
(
àà 
client
àà 
!=
àà 
null
àà "
)
àà" #
client
ââ 
.
ââ 
myLogger
ââ #
.
ââ# $
Log
ââ$ '
(
ââ' (
sm
ââ( *
.
ââ* +
msg
ââ+ .
.
ââ. /
ToString
ââ/ 7
(
ââ7 8
)
ââ8 9
)
ââ9 :
;
ââ: ;
else
ää 
Console
ãã 
.
ãã 
	WriteLine
ãã %
(
ãã% &
$str
ãã& A
)
ããA B
;
ããB C
}
åå 
;
åå 
}
çç 	
private
èè 
bool
èè 
ValidateClient
èè #
(
èè# $
)
èè$ %
{
êê 	
return
ëë 
!
ëë 
string
ëë 
.
ëë  
IsNullOrWhiteSpace
ëë -
(
ëë- .
clientIP
ëë. 6
.
ëë6 7
Text
ëë7 ;
)
ëë; <
;
ëë< =
}
íí 	
private
îî 
bool
îî 
ValidateServer
îî #
(
îî# $
)
îî$ %
{
ïï 	
return
ññ 
!
ññ 
string
ññ 
.
ññ  
IsNullOrWhiteSpace
ññ -
(
ññ- .
serverIP
ññ. 6
.
ññ6 7
Text
ññ7 ;
)
ññ; <
;
ññ< =
}
óó 	
private
ôô 
void
ôô 
startServer_Click
ôô &
(
ôô& '
object
ôô' -
sender
ôô. 4
,
ôô4 5
	EventArgs
ôô6 ?
e
ôô@ A
)
ôôA B
{
öö 	
Start
õõ 
(
õõ 
false
õõ 
)
õõ 
;
õõ 
}
úú 	
private
ûû 
void
ûû !
clientConnect_Click
ûû (
(
ûû( )
object
ûû) /
sender
ûû0 6
,
ûû6 7
	EventArgs
ûû8 A
e
ûûB C
)
ûûC D
{
üü 	
Start
†† 
(
†† 
true
†† 
)
†† 
;
†† 
}
°° 	
private
££ 
void
££ 
sendMsg_Click
££ "
(
££" #
object
££# )
sender
££* 0
,
££0 1
	EventArgs
££2 ;
e
££< =
)
££= >
{
§§ 	
client
•• 
.
•• 
SendData
•• 
(
•• 
	clientMsg
•• %
.
••% &
Text
••& *
)
••* +
;
••+ ,
	clientMsg
¶¶ 
.
¶¶ 
Text
¶¶ 
=
¶¶ 
$str
¶¶ 
;
¶¶  
}
ßß 	
public
©© 
void
©© 
SetName
©© 
(
©© 
string
©© "
name
©©# '
)
©©' (
{
™™ 	

clientName
´´ 
.
´´ 
Text
´´ 
=
´´ 
name
´´ "
;
´´" #
}
¨¨ 	
private
ÆÆ 
void
ÆÆ 
frmSocket_Closing
ÆÆ &
(
ÆÆ& '
object
ÆÆ' -
sender
ÆÆ. 4
,
ÆÆ4 5"
FormClosingEventArgs
ÆÆ6 J
e
ÆÆK L
)
ÆÆL M
{
ØØ 	
if
∞∞ 
(
∞∞ 
state
∞∞ 
==
∞∞ 
SocketState
∞∞ $
.
∞∞$ %
ClientStarted
∞∞% 2
)
∞∞2 3
client
±± 
.
±± 
Stop
±± 
(
±± 
)
±± 
;
±± 
if
≤≤ 
(
≤≤ 
state
≤≤ 
==
≤≤ 
SocketState
≤≤ $
.
≤≤$ %
ServerStarted
≤≤% 2
)
≤≤2 3
server
≥≥ 
.
≥≥ 

PoliteStop
≥≥ !
(
≥≥! "
)
≥≥" #
;
≥≥# $
}
¥¥ 	
private
∂∂ 
void
∂∂ 
EnableControls
∂∂ #
(
∂∂# $
bool
∂∂$ (
isClient
∂∂) 1
)
∂∂1 2
{
∑∑ 	
ControlControls
∏∏ 
(
∏∏ 
isClient
∏∏ $
,
∏∏$ %
true
∏∏& *
)
∏∏* +
;
∏∏+ ,
}
ππ 	
private
ªª 
void
ªª 
DisableControls
ªª $
(
ªª$ %
bool
ªª% )
isClient
ªª* 2
)
ªª2 3
{
ºº 	
ControlControls
ΩΩ 
(
ΩΩ 
isClient
ΩΩ $
,
ΩΩ$ %
false
ΩΩ& +
)
ΩΩ+ ,
;
ΩΩ, -
}
ææ 	
internal
¿¿ 
void
¿¿ 
ControlControls
¿¿ %
(
¿¿% &
bool
¿¿& *
isClient
¿¿+ 3
,
¿¿3 4
bool
¿¿5 9
enable
¿¿: @
)
¿¿@ A
{
¡¡ 	
TabPage
¬¬ 
tb
¬¬ 
=
¬¬ 
tabPage2
¬¬ !
;
¬¬! "
if
√√ 
(
√√ 
!
√√ 
isClient
√√ 
)
√√ 
tb
√√ 
=
√√ 
tabPage1
√√  (
;
√√( )
foreach
≈≈ 
(
≈≈ 
Control
≈≈ 
c
≈≈ 
in
≈≈ !
tb
≈≈" $
.
≈≈$ %
Controls
≈≈% -
)
≈≈- .
c
∆∆ 
.
∆∆ 
Enabled
∆∆ 
=
∆∆ 
enable
∆∆ "
;
∆∆" #
}
«« 	
}
»» 
}…… ÃA
TD:\VISUAL STUDIO\Visual Studio Projects\Prueba-Sockets-L2API\Dummy-Socket\Program.cs
	namespace 	
Dummy_Socket
 
{ 
internal 
static 
class 
Program !
{ 
[ 	
	STAThread	 
] 
private 
static 
void 
Main  
(  !
)! "
{ 	
Application 
. 
EnableVisualStyles *
(* +
)+ ,
;, -
Application 
. -
!SetCompatibleTextRenderingDefault 9
(9 :
false: ?
)? @
;@ A
Application 
. 
Run 
( 
new 
frmMain  '
(' (
)( )
)) *
;* +
} 	
public 
static 
string 
	AppFolder &
{ 	
get 
{ 
return 
Path 
. 
GetDirectoryName ,
(, -
Assembly- 5
.5 6 
GetExecutingAssembly6 J
(J K
)K L
.L M
LocationM U
)U V
;V W
} 
}   	
}!! 
public## 

class## 
EnhancedForm## 
<## 
T## 
>##  
:##! "
Form### '
{$$ 
private%% 
static%% 
T%% 
_eForm%% 
;%%  
public'' 
static'' 
T'' 
Me'' 
{(( 	
get)) 
{** 
if++ 
(++ 
_eForm++ 
==++ 
null++ "
)++" #
_eForm,, 
=,, 
(,, 
T,, 
),,  
	Activator,,! *
.,,* +
CreateInstance,,+ 9
(,,9 :
typeof,,: @
(,,@ A
T,,A B
),,B C
),,C D
;,,D E
return-- 
_eForm-- 
;-- 
}.. 
}// 	
public11 
T111 
CreateInstance11  
<11  !
T111! #
>11# $
(11$ %
)11% &
where11' ,
T111- /
:110 1
T112 3
{22 	
_eForm33 
=33 
(33 
T33 
)33 
	Activator33 "
.33" #
CreateInstance33# 1
(331 2
typeof332 8
(338 9
T1339 ;
)33; <
)33< =
;33= >
return44 
(44 
T144 
)44 
_eForm44 
;44 
}55 	
public77 
static77 
Configuration77 #
cfg77$ '
{88 	
get99 
{:: 
return;; 

frmOptions;; !
.;;! "
config;;" (
;;;( )
}<< 
}== 	
}>> 
public@@ 

class@@ 
SocketInstance@@ 
{AA 
publicBB 
	frmSocketBB 
instanceBB !
;BB! "
publicCC 
boolCC 
isClientCC 
;CC 
publicEE 
SocketInstanceEE 
(EE 
	frmSocketEE '
iEE( )
,EE) *
boolEE+ /
icEE0 2
)EE2 3
{FF 	
instanceGG 
=GG 
iGG 
;GG 
isClientHH 
=HH 
icHH 
;HH 
}II 	
}JJ 
publicLL 

staticLL 
classLL 
JSONHandlerLL #
{MM 
publicNN 
staticNN 
voidNN 
SerializeToFileNN *
<NN* +
TNN+ ,
>NN, -
(NN- .
stringNN. 4
pathNN5 9
,NN9 :
TNN; <
objNN= @
)NN@ A
{OO 	
tryPP 
{QQ 
FileRR 
.RR 
WriteAllTextRR !
(RR! "
pathRR" &
,RR& '
JsonConvertRR( 3
.RR3 4
SerializeObjectRR4 C
(RRC D
objRRD G
)RRG H
)RRH I
;RRI J
}SS 
catchTT 
(TT 
	ExceptionTT 
exTT 
)TT  
{UU 
ConsoleVV 
.VV 
	WriteLineVV !
(VV! "
$strVV" G
+VVH I
exVVJ L
)VVL M
;VVM N
}WW 
}XX 	
publicZZ 
staticZZ 
TZZ 
DeserializeFromFileZZ +
<ZZ+ ,
TZZ, -
>ZZ- .
(ZZ. /
stringZZ/ 5
pathZZ6 :
)ZZ: ;
{[[ 	
try\\ 
{]] 
return^^ 
JsonConvert^^ "
.^^" #
DeserializeObject^^# 4
<^^4 5
T^^5 6
>^^6 7
(^^7 8
File^^8 <
.^^< =
ReadAllText^^= H
(^^H I
path^^I M
)^^M N
)^^N O
;^^O P
}__ 
catch`` 
(`` 
	Exception`` 
ex`` 
)``  
{aa 
Consolebb 
.bb 
	WriteLinebb !
(bb! "
$strbb" I
+bbJ K
exbbL N
)bbN O
;bbO P
returncc 
defaultcc 
(cc 
Tcc  
)cc  !
;cc! "
}dd 
}ee 	
publicgg 
staticgg 
objectgg 
DeserializeFromFilegg 0
(gg0 1
stringgg1 7
pathgg8 <
)gg< =
{hh 	
tryii 
{jj 
returnkk 
JsonConvertkk "
.kk" #
DeserializeObjectkk# 4
(kk4 5
Filekk5 9
.kk9 :
ReadAllTextkk: E
(kkE F
pathkkF J
)kkJ K
)kkK L
;kkL M
}ll 
catchmm 
(mm 
	Exceptionmm 
exmm 
)mm  
{nn 
Consoleoo 
.oo 
	WriteLineoo !
(oo! "
$stroo" I
+ooJ K
exooL N
)ooN O
;ooO P
returnpp 
nullpp 
;pp 
}qq 
}rr 	
publictt 
statictt 
booltt 
IsJsontt !
(tt! "
thistt" &
stringtt' -
strInputtt. 6
)tt6 7
{uu 	
strInputvv 
=vv 
strInputvv 
.vv  
Trimvv  $
(vv$ %
)vv% &
;vv& '
ifww 
(ww 
(ww 
strInputww 
.ww 

StartsWithww $
(ww$ %
$strww% (
)ww( )
&&ww* ,
strInputww- 5
.ww5 6
EndsWithww6 >
(ww> ?
$strww? B
)wwB C
)wwC D
||wwE G
(xx 
strInputxx 
.xx 

StartsWithxx $
(xx$ %
$strxx% (
)xx( )
&&xx* ,
strInputxx- 5
.xx5 6
EndsWithxx6 >
(xx> ?
$strxx? B
)xxB C
)xxC D
)xxD E
{yy 
tryzz 
{{{ 
JToken|| 
obj|| 
=||  
JToken||! '
.||' (
Parse||( -
(||- .
strInput||. 6
)||6 7
;||7 8
return}} 
true}} 
;}}  
}~~ 
catch 
( 
JsonReaderException *
jex+ .
). /
{
ÄÄ 
Console
ÇÇ 
.
ÇÇ 
	WriteLine
ÇÇ %
(
ÇÇ% &
jex
ÇÇ& )
.
ÇÇ) *
Message
ÇÇ* 1
)
ÇÇ1 2
;
ÇÇ2 3
return
ÉÉ 
false
ÉÉ  
;
ÉÉ  !
}
ÑÑ 
catch
ÖÖ 
(
ÖÖ 
	Exception
ÖÖ  
ex
ÖÖ! #
)
ÖÖ# $
{
ÜÜ 
Console
áá 
.
áá 
	WriteLine
áá %
(
áá% &
ex
áá& (
.
áá( )
ToString
áá) 1
(
áá1 2
)
áá2 3
)
áá3 4
;
áá4 5
return
àà 
false
àà  
;
àà  !
}
ââ 
}
ää 
else
ãã 
{
åå 
return
çç 
false
çç 
;
çç 
}
éé 
}
èè 	
}
êê 
}ëë è
dD:\VISUAL STUDIO\Visual Studio Projects\Prueba-Sockets-L2API\Dummy-Socket\Properties\AssemblyInfo.cs
[ 
assembly 	
:	 

AssemblyTitle 
( 
$str '
)' (
]( )
[		 
assembly		 	
:			 

AssemblyDescription		 
(		 
$str		 !
)		! "
]		" #
[

 
assembly

 	
:

	 
!
AssemblyConfiguration

  
(

  !
$str

! #
)

# $
]

$ %
[ 
assembly 	
:	 

AssemblyCompany 
( 
$str 
) 
] 
[ 
assembly 	
:	 

AssemblyProduct 
( 
$str )
)) *
]* +
[ 
assembly 	
:	 

AssemblyCopyright 
( 
$str 0
)0 1
]1 2
[ 
assembly 	
:	 

AssemblyTrademark 
( 
$str 
)  
]  !
[ 
assembly 	
:	 

AssemblyCulture 
( 
$str 
) 
] 
[ 
assembly 	
:	 


ComVisible 
( 
false 
) 
] 
[ 
assembly 	
:	 

Guid 
( 
$str 6
)6 7
]7 8
[## 
assembly## 	
:##	 

AssemblyVersion## 
(## 
$str## $
)##$ %
]##% &
[$$ 
assembly$$ 	
:$$	 

AssemblyFileVersion$$ 
($$ 
$str$$ (
)$$( )
]$$) *Ëï
YD:\VISUAL STUDIO\Visual Studio Projects\Prueba-Sockets-L2API\Dummy-Socket\SocketClient.cs
	namespace 	
DeltaSockets
 
{		 
public 

class 
SocketClient 
{ 
public 
SocketClientConsole "
myLogger# +
=, -
new. 1
SocketClientConsole2 E
(E F
nullF J
)J K
;K L
public 
Socket 
ClientSocket "
;" #
public 
	IPAddress 
IP 
; 
public 
int 
Port 
, 
Id 
; 
private!! 
SocketState!! 
_state!! "
;!!" #
public"" 
SocketState"" 
myState"" "
{## 	
get$$ 
{%% 
return&& 
_state&& 
;&& 
}'' 
}(( 	
private** 

IPEndPoint** 
	_endpoint** $
;**$ %
private-- 
readonly-- 
Timer-- 
task-- #
;--# $
private.. 
readonly.. 
Action.. 
act..  #
;..# $
private// 
readonly// 
int// 
period// #
=//$ %
$num//& '
;//' (
internal11 

IPEndPoint11 
IPEnd11 !
{22 	
get33 
{44 
if55 
(55 
IP55 
!=55 
null55 
)55 
{66 
if77 
(77 
	_endpoint77 !
==77" $
null77% )
)77) *
	_endpoint88 !
=88" #
new88$ '

IPEndPoint88( 2
(882 3
IP883 5
,885 6
Port887 ;
)88; <
;88< =
return99 
	_endpoint99 $
;99$ %
}:: 
else;; 
return;; 
null;;  
;;;  !
}<< 
}== 	
publicCC 
SocketClientCC 
(CC 
boolCC  
doConnectionCC! -
=CC. /
falseCC0 5
)CC5 6
:CC7 8
thisDD 
(DD 
	IPAddressDD 
.DD 
LoopbackDD #
,DD# $
SocketServerDD% 1
.DD1 2
DefPortDD2 9
,DD9 :

SocketTypeDD; E
.DDE F
StreamDDF L
,DDL M
ProtocolTypeDDN Z
.DDZ [
TcpDD[ ^
,DD^ _
-DD` a
$numDDa b
,DDb c
nullDDd h
,DDh i
doConnectionDDj v
)DDv w
{EE 	
}EE
 
publicLL 
SocketClientLL 
(LL 
ActionLL "
	everyFuncLL# ,
,LL, -
boolLL. 2
doConnectionLL3 ?
=LL@ A
falseLLB G
)LLG H
:LLI J
thisMM 
(MM 
	IPAddressMM 
.MM 
LoopbackMM #
,MM# $
SocketServerMM% 1
.MM1 2
DefPortMM2 9
,MM9 :

SocketTypeMM; E
.MME F
StreamMMF L
,MML M
ProtocolTypeMMN Z
.MMZ [
TcpMM[ ^
,MM^ _
-MM` a
$numMMa b
,MMb c
	everyFuncMMd m
,MMm n
doConnectionMMo {
)MM{ |
{NN 	
}NN
 
publicVV 
SocketClientVV 
(VV 
stringVV "
ipVV# %
,VV% &
intVV' *
portVV+ /
,VV/ 0
boolVV1 5
doConnectionVV6 B
=VVC D
falseVVE J
)VVJ K
:VVL M
thisWW 
(WW 
ipWW 
,WW 
portWW 
,WW 
nullWW 
,WW  
$numWW! $
,WW$ %
doConnectionWW& 2
)WW2 3
{XX 	
}XX
 
publicZZ 
SocketClientZZ 
(ZZ 
	IPAddressZZ %
ipZZ& (
,ZZ( )
intZZ* -
portZZ. 2
,ZZ2 3
boolZZ4 8
doConnectionZZ9 E
=ZZF G
falseZZH M
)ZZM N
:ZZO P
this[[ 
([[ 
ip[[ 
,[[ 
port[[ 
,[[ 

SocketType[[ %
.[[% &
Stream[[& ,
,[[, -
ProtocolType[[. :
.[[: ;
Tcp[[; >
,[[> ?
$num[[@ C
,[[C D
null[[E I
,[[I J
doConnection[[K W
)[[W X
{\\ 	
}\\
 
public^^ 
SocketClient^^ 
(^^ 
	IPAddress^^ %
ip^^& (
,^^( )
int^^* -
port^^. 2
,^^2 3
Action^^4 :
	everyFunc^^; D
,^^D E
int^^F I
	readEvery^^J S
=^^T U
$num^^V Y
,^^Y Z
bool^^[ _
doConnection^^` l
=^^m n
false^^o t
)^^t u
:^^v w
this__ 
(__ 
ip__ 
,__ 
port__ 
,__ 

SocketType__ %
.__% &
Stream__& ,
,__, -
ProtocolType__. :
.__: ;
Tcp__; >
,__> ?
	readEvery__@ I
,__I J
	everyFunc__K T
,__T U
doConnection__V b
)__b c
{`` 	
}``
 
publicjj 
SocketClientjj 
(jj 
stringjj "
ipjj# %
,jj% &
intjj' *
portjj+ /
,jj/ 0
Actionjj1 7
	everyFuncjj8 A
,jjA B
intjjC F
	readEveryjjG P
=jjQ R
$numjjS V
,jjV W
booljjX \
doConnectionjj] i
=jjj k
falsejjl q
)jjq r
:jjs t
thiskk 
(kk 
	IPAddresskk 
.kk 
Parsekk  
(kk  !
ipkk! #
)kk# $
,kk$ %
portkk& *
,kk* +

SocketTypekk, 6
.kk6 7
Streamkk7 =
,kk= >
ProtocolTypekk? K
.kkK L
TcpkkL O
,kkO P
	readEverykkQ Z
,kkZ [
	everyFunckk\ e
,kke f
doConnectionkkg s
)kks t
{ll 	
}ll
 
publicxx 
SocketClientxx 
(xx 
	IPAddressxx %
ipAddrxx& ,
,xx, -
intxx. 1
portxx2 6
,xx6 7

SocketTypexx8 B
sTypexxC H
,xxH I
ProtocolTypexxJ V
pTypexxW \
,xx\ ]
intxx^ a
	readEveryxxb k
,xxk l
Actionxxm s
	everyFuncxxt }
,xx} ~
bool	xx É
doConnection
xxÑ ê
=
xxë í
false
xxì ò
)
xxò ô
{yy 	
period|| 
=|| 
	readEvery|| 
;|| 
act~~ 
=~~ 
	everyFunc~~ 
;~~ 
TimerCallback 
timerDelegate '
=( )
new* -
TimerCallback. ;
(; <
Timering< D
)D E
;E F
if
ÅÅ 
(
ÅÅ 
	everyFunc
ÅÅ 
!=
ÅÅ 
null
ÅÅ !
)
ÅÅ! "
task
ÇÇ 
=
ÇÇ 
new
ÇÇ 
Timer
ÇÇ  
(
ÇÇ  !
timerDelegate
ÇÇ! .
,
ÇÇ. /
null
ÇÇ0 4
,
ÇÇ4 5
$num
ÇÇ6 7
,
ÇÇ7 8
	readEvery
ÇÇ9 B
)
ÇÇB C
;
ÇÇC D
IP
ÑÑ 
=
ÑÑ 
ipAddr
ÑÑ 
;
ÑÑ 
Port
ÖÖ 
=
ÖÖ 
port
ÖÖ 
;
ÖÖ 
ClientSocket
áá 
=
áá 
new
áá 
Socket
áá %
(
áá% &
ipAddr
áá& ,
.
áá, -
AddressFamily
áá- :
,
áá: ;
sType
áá< A
,
ááA B
pType
ááC H
)
ááH I
{
àà 
NoDelay
ââ 
=
ââ 
false
ââ 
}
ää 
;
ää 
Id
åå 
=
åå 
ClientSocket
åå 
.
åå 
GetHashCode
åå )
(
åå) *
)
åå* +
;
åå+ ,
if
éé 
(
éé 
doConnection
éé 
)
éé 
DoConnection
èè 
(
èè 
)
èè 
;
èè 
}
êê 	
	protected
ïï 
void
ïï 
StartReceiving
ïï %
(
ïï% &
)
ïï& '
{
ññ 	

_Receiving
óó 
(
óó 
period
óó 
)
óó 
;
óó 
}
òò 	
	protected
ùù 
void
ùù 
StopReceiving
ùù $
(
ùù$ %
)
ùù% &
{
ûû 	

_Receiving
üü 
(
üü 
)
üü 
;
üü 
}
†† 	
private
¢¢ 
void
¢¢ 

_Receiving
¢¢ 
(
¢¢  
int
¢¢  #
p
¢¢$ %
=
¢¢& '
$num
¢¢( )
)
¢¢) *
{
££ 	
if
§§ 
(
§§ 
task
§§ 
!=
§§ 
null
§§ 
)
§§ 
task
•• 
.
•• 
Change
•• 
(
•• 
$num
•• 
,
•• 
p
••  
)
••  !
;
••! "
}
¶¶ 	
public
´´ 
void
´´ 
DoConnection
´´  
(
´´  !
)
´´! "
{
¨¨ 	
if
≠≠ 
(
≠≠ 
IPEnd
≠≠ 
!=
≠≠ 
null
≠≠ 
)
≠≠ 
{
ÆÆ 
try
ØØ 
{
∞∞ 
ClientSocket
±±  
.
±±  !
Connect
±±! (
(
±±( )
IPEnd
±±) .
)
±±. /
;
±±/ 0
StartReceiving
≤≤ "
(
≤≤" #
)
≤≤# $
;
≤≤$ %
ClientSocket
≥≥  
.
≥≥  !
Send
≥≥! %
(
≥≥% &
SocketManager
≥≥& 3
.
≥≥3 4
	Serialize
≥≥4 =
(
≥≥= >
Id
≥≥> @
,
≥≥@ A
$str
≥≥B J
)
≥≥J K
)
≥≥K L
;
≥≥L M
}
¥¥ 
catch
µµ 
(
µµ 
	Exception
µµ  
ex
µµ! #
)
µµ# $
{
∂∂ 
Console
∑∑ 
.
∑∑ 
	WriteLine
∑∑ %
(
∑∑% &
$str
∑∑& Q
+
∑∑R S
ex
∑∑T V
)
∑∑V W
;
∑∑W X
return
∏∏ 
;
∏∏ 
}
ππ 
_state
∫∫ 
=
∫∫ 
SocketState
∫∫ $
.
∫∫$ %
ClientStarted
∫∫% 2
;
∫∫2 3
}
ªª 
else
ºº 
Console
ΩΩ 
.
ΩΩ 
	WriteLine
ΩΩ !
(
ΩΩ! "
$str
ΩΩ" A
)
ΩΩA B
;
ΩΩB C
}
ææ 	
public
¿¿ 
int
¿¿ 
SendData
¿¿ 
(
¿¿ 
object
¿¿ "
msg
¿¿# &
)
¿¿& '
{
¡¡ 	
if
¬¬ 
(
¬¬ 
!
¬¬ 
ClientSocket
¬¬ 
.
¬¬ 
Equals
¬¬ $
(
¬¬$ %
null
¬¬% )
)
¬¬) *
&&
¬¬+ -
ClientSocket
¬¬. :
.
¬¬: ;
	Connected
¬¬; D
)
¬¬D E
{
√√ 
int
ƒƒ 
	bytesSend
ƒƒ 
=
ƒƒ 
$num
ƒƒ  !
;
ƒƒ! "
byte
≈≈ 
[
≈≈ 
]
≈≈ 
bytes
≈≈ 
=
≈≈ 
SocketManager
≈≈ ,
.
≈≈, -
	Serialize
≈≈- 6
(
≈≈6 7
Id
≈≈7 9
,
≈≈9 :
msg
≈≈; >
)
≈≈> ?
;
≈≈? @
if
«« 
(
«« 
bytes
«« 
.
«« 
Length
««  
>
««! "
$num
««# '
)
««' (
	bytesSend
»» 
+=
»»  
ClientSocket
»»! -
.
»»- .
Send
»». 2
(
»»2 3
SocketManager
»»3 @
.
»»@ A
	Serialize
»»A J
(
»»J K
Id
»»K M
,
»»M N
$str
»»O \
+
»»] ^
bytes
»»_ d
.
»»d e
Length
»»e k
)
»»k l
)
»»l m
;
»»m n
	bytesSend
   
+=
   
ClientSocket
   )
.
  ) *
Send
  * .
(
  . /
bytes
  / 4
)
  4 5
;
  5 6
return
ÃÃ 
	bytesSend
ÃÃ  
;
ÃÃ  !
}
ÕÕ 
else
ŒŒ 
{
œœ 
return
–– 
$num
–– 
;
–– 
}
—— 
}
““ 	
private
‘‘ 
void
‘‘ 
	BreakLine
‘‘ 
(
‘‘ 
)
‘‘  
{
’’ 	
ClientSocket
÷÷ 
.
÷÷ 
Send
÷÷ 
(
÷÷ 
Encoding
÷÷ &
.
÷÷& '
Unicode
÷÷' .
.
÷÷. /
GetBytes
÷÷/ 7
(
÷÷7 8
$str
÷÷8 @
)
÷÷@ A
)
÷÷A B
;
÷÷B C
}
◊◊ 	
public
ﬁﬁ 
bool
ﬁﬁ 
ReceiveData
ﬁﬁ 
(
ﬁﬁ  
out
ﬁﬁ  #
SocketMessage
ﬁﬁ$ 1
msg
ﬁﬁ2 5
)
ﬁﬁ5 6
{
ﬂﬂ 	
try
‡‡ 
{
·· 
int
„„ 
bytesRec
„„ 
=
„„ 
$num
„„  
;
„„  !
byte
‰‰ 
[
‰‰ 
]
‰‰ 
bytes
‰‰ 
=
‰‰ 
new
‰‰ "
byte
‰‰# '
[
‰‰' (
$num
‰‰( ,
]
‰‰, -
;
‰‰- .
if
ÊÊ 
(
ÊÊ 
!
ÊÊ 
ClientSocket
ÊÊ !
.
ÊÊ! "
Equals
ÊÊ" (
(
ÊÊ( )
null
ÊÊ) -
)
ÊÊ- .
)
ÊÊ. /
{
ÁÁ 
Console
ËË 
.
ËË 
	WriteLine
ËË %
(
ËË% &
$str
ËË& k
,
ËËk l
Id
ËËm o
)
ËËo p
;
ËËp q
Stop
ÏÏ 
(
ÏÏ 
)
ÏÏ 
;
ÏÏ 
msg
ÌÌ 
=
ÌÌ 
null
ÌÌ 
;
ÌÌ 
return
ÓÓ 
false
ÓÓ  
;
ÓÓ  !
}
ÔÔ 
while
ÚÚ 
(
ÚÚ 
ClientSocket
ÚÚ #
.
ÚÚ# $
	Available
ÚÚ$ -
>
ÚÚ. /
$num
ÚÚ0 1
)
ÚÚ1 2
bytesRec
ÛÛ 
=
ÛÛ 
ClientSocket
ÛÛ +
.
ÛÛ+ ,
Receive
ÛÛ, 3
(
ÛÛ3 4
bytes
ÛÛ4 9
)
ÛÛ9 :
;
ÛÛ: ;
SocketMessage
ıı 
sm
ıı  
=
ıı! "
null
ıı# '
;
ıı' (
SocketManager
˜˜ 
.
˜˜ 
Deserialize
˜˜ )
(
˜˜) *
bytes
˜˜* /
,
˜˜/ 0
out
˜˜1 4
sm
˜˜5 7
,
˜˜7 8
SocketDbgType
˜˜9 F
.
˜˜F G
Client
˜˜G M
)
˜˜M N
;
˜˜N O
msg
˘˘ 
=
˘˘ 
sm
˘˘ 
;
˘˘ 
if
˚˚ 
(
˚˚ 
sm
˚˚ 
.
˚˚ 
StringValue
˚˚ "
==
˚˚# %
$str
˚˚& /
)
˚˚/ 0
{
¸¸ 
Console
˝˝ 
.
˝˝ 
	WriteLine
˝˝ %
(
˝˝% &
$str
˝˝& =
)
˝˝= >
;
˝˝> ?
SendData
˛˛ 
(
˛˛ 
$str
˛˛ .
)
˛˛. /
;
˛˛/ 0
Stop
ˇˇ 
(
ˇˇ 
)
ˇˇ 
;
ˇˇ 
return
ÄÄ 
false
ÄÄ  
;
ÄÄ  !
}
ÅÅ 
return
ÉÉ 
true
ÉÉ 
;
ÉÉ 
}
ÑÑ 
catch
ÖÖ 
(
ÖÖ 
	Exception
ÖÖ 
ex
ÖÖ 
)
ÖÖ  
{
ÜÜ 
Console
áá 
.
áá 
	WriteLine
áá !
(
áá! "
$str
áá" L
+
ááM N
ex
ááO Q
.
ááQ R
ToString
ááR Z
(
ááZ [
)
áá[ \
)
áá\ ]
;
áá] ^
msg
àà 
=
àà 
null
àà 
;
àà 
SendData
ââ 
(
ââ 
$str
ââ *
)
ââ* +
;
ââ+ ,
Stop
ää 
(
ää 
)
ää 
;
ää 
return
ãã 
false
ãã 
;
ãã 
}
åå 
}
çç 	
private
èè 
void
èè 
CloseConnection
èè $
(
èè$ %
SocketShutdown
èè% 3

soShutdown
èè4 >
)
èè> ?
{
êê 	
if
ëë 
(
ëë 

soShutdown
ëë 
==
ëë 
SocketShutdown
ëë ,
.
ëë, -
Receive
ëë- 4
)
ëë4 5
{
íí 
Console
ìì 
.
ìì 
	WriteLine
ìì !
(
ìì! "
$strìì" Ñ
)ììÑ Ö
;ììÖ Ü
return
îî 
;
îî 
}
ïï 
if
ññ 
(
ññ 
ClientSocket
ññ 
.
ññ 
	Connected
ññ &
)
ññ& '
{
óó 
ClientSocket
òò 
.
òò 

Disconnect
òò '
(
òò' (
false
òò( -
)
òò- .
;
òò. /
if
ôô 
(
ôô 
ClientSocket
ôô  
.
ôô  !
	Connected
ôô! *
)
ôô* +
ClientSocket
öö  
.
öö  !
Shutdown
öö! )
(
öö) *

soShutdown
öö* 4
)
öö4 5
;
öö5 6
}
õõ 
}
úú 	
public
°° 
void
°° 
Dispose
°° 
(
°° 
)
°° 
{
¢¢ 	
ClientSocket
££ 
.
££ 
Close
££ 
(
££ 
)
££  
;
££  !
}
§§ 	
public
©© 
void
©© 
Stop
©© 
(
©© 
)
©© 
{
™™ 	
if
´´ 
(
´´ 
_state
´´ 
==
´´ 
SocketState
´´ %
.
´´% &
ClientStarted
´´& 3
)
´´3 4
{
¨¨ 
try
≠≠ 
{
ÆÆ 
Console
ØØ 
.
ØØ 
	WriteLine
ØØ %
(
ØØ% &
$str
ØØ& 6
)
ØØ6 7
;
ØØ7 8
_state
±± 
=
±± 
SocketState
±± (
.
±±( )
ClientStopped
±±) 6
;
±±6 7
CloseConnection
≤≤ #
(
≤≤# $
SocketShutdown
≤≤$ 2
.
≤≤2 3
Both
≤≤3 7
)
≤≤7 8
;
≤≤8 9
Dispose
≥≥ 
(
≥≥ 
)
≥≥ 
;
≥≥ 
}
¥¥ 
catch
µµ 
(
µµ 
	Exception
µµ  
ex
µµ! #
)
µµ# $
{
∂∂ 
Console
∑∑ 
.
∑∑ 
	WriteLine
∑∑ %
(
∑∑% &
$str
∑∑& W
+
∑∑X Y
ex
∑∑Z \
)
∑∑\ ]
;
∑∑] ^
}
∏∏ 
}
ππ 
else
∫∫ 
Console
ªª 
.
ªª 
	WriteLine
ªª !
(
ªª! "
$str
ªª" \
)
ªª\ ]
;
ªª] ^
}
ºº 	
private
ææ 
void
ææ 
Timering
ææ 
(
ææ 
object
ææ $
	stateInfo
ææ% .
)
ææ. /
{
øø 	
act
¿¿ 
(
¿¿ 
)
¿¿ 
;
¿¿ 
}
¡¡ 	
}
¬¬ 
}√√ ∏`
ZD:\VISUAL STUDIO\Visual Studio Projects\Prueba-Sockets-L2API\Dummy-Socket\SocketManager.cs
	namespace 	
DeltaSockets
 
{ 
public 

enum 
SocketDbgType 
{		 
Client

 
,

 
Server 
} 
public 

enum 
SocketState 
{ 

NonStarted 
, 
ClientStarted 
, 
ServerStarted 
, 
ClientStopped 
, 
ServerStopped 
} 
[ 
Serializable 
] 
public 

class 
SocketMessage 
{ 
public 
string 
StringValue !
{ 	
get 
{   
try!! 
{"" 
return## 
(## 
string## "
)##" #
msg### &
;##& '
}$$ 
catch%% 
{&& 
return'' 
$str'' 
;'' 
}(( 
})) 
}** 	
public,, 
int,, 
IntValue,, 
{-- 	
get.. 
{// 
try00 
{11 
return22 
(22 
int22 
)22  
msg22  #
;22# $
}33 
catch44 
{55 
return66 
-66 
$num66 
;66 
}77 
}88 
}99 	
public>> 
int>> 
id>> 
;>> 
public@@ 
string@@ 

TypeString@@  
;@@  !
publicFF 
objectFF 
msgFF 
;FF 
publicMM 
SocketMessageMM 
(MM 
intMM  
iMM! "
,MM" #
objectMM$ *
mMM+ ,
)MM, -
{NN 	
idOO 
=OO 
iOO 
;OO 
msgPP 
=PP 
mPP 
;PP 
}QQ 	
}RR 
publicTT 

classTT 
SocketManagerTT 
{UU 
publicVV 
staticVV 
byteVV 
[VV 
]VV 
	SerializeVV &
<VV& '
TVV' (
>VV( )
(VV) *
intVV* -
IdVV. 0
,VV0 1
TVV2 3!
anySerializableObjectVV4 I
,VVI J
SocketDbgTypeVVK X
typeVVY ]
=VV^ _
SocketDbgTypeVV` m
.VVm n
ClientVVn t
)VVt u
{WW 	
tryXX 
{YY 
usingZZ 
(ZZ 
varZZ 
memoryStreamZZ '
=ZZ( )
newZZ* -
MemoryStreamZZ. :
(ZZ: ;
)ZZ; <
)ZZ< =
{[[ 
memoryStream\\  
.\\  !
Seek\\! %
(\\% &
$num\\& '
,\\' (

SeekOrigin\\) 3
.\\3 4
Begin\\4 9
)\\9 :
;\\: ;
(]] 
new]] 
BinaryFormatter]] (
(]]( )
)]]) *
)]]* +
.]]+ ,
	Serialize]], 5
(]]5 6
memoryStream]]6 B
,]]B C
new]]D G
SocketMessage]]H U
(]]U V
Id]]V X
,]]X Y!
anySerializableObject]]Z o
)]]o p
{]]q r

TypeString]]s }
=]]~ 
typeof
]]Ä Ü
(
]]Ü á
T
]]á à
)
]]à â
.
]]â ä
Name
]]ä é
}
]]è ê
)
]]ê ë
;
]]ë í
byte__ 
[__ 
]__ 
bytes__  
=__! "
memoryStream__# /
.__/ 0
ToArray__0 7
(__7 8
)__8 9
;__9 :
Console`` 
.`` 
	WriteLine`` %
(``% &
$str``& B
,``B C
bytes``D I
.``I J
Length``J P
,``P Q
type``R V
.``V W
ToString``W _
(``_ `
)``` a
.``a b
ToUpper``b i
(``i j
)``j k
)``k l
;``l m
returnbb 
bytesbb  
;bb  !
}cc 
}dd 
catchee 
(ee 
	Exceptionee 
exee 
)ee  
{ff 
Consolegg 
.gg 
	WriteLinegg !
(gg! "
$strgg" B
+ggC D
exggE G
,ggG H
typeggI M
.ggM N
ToStringggN V
(ggV W
)ggW X
.ggX Y
ToUpperggY `
(gg` a
)gga b
)ggb c
;ggc d
returnhh 
nullhh 
;hh 
}ii 
}jj 	
publicll 
staticll 
boolll 
Deserializell &
<ll& '
Tll' (
>ll( )
(ll) *
bytell* .
[ll. /
]ll/ 0
messagell1 8
,ll8 9
outll: =
Tll> ?
smll@ B
,llB C
SocketDbgTypellD Q
typellR V
)llV W
{mm 	
ifnn 
(nn 
messagenn 
==nn 
nullnn 
||nn  "
messagenn# *
.nn* +
Lengthnn+ 1
==nn2 4
$numnn5 6
||nn7 9
(nn: ;
messagenn; B
.nnB C
LengthnnC I
==nnJ L
$numnnM N
&&nnO Q
messagennR Y
[nnY Z
$numnnZ [
]nn[ \
==nn] _
$numnn` a
)nna b
)nnb c
{oo 
Consoleqq 
.qq 
	WriteLineqq !
(qq! "
$strqq" A
)qqA B
;qqB C
smrr 
=rr 
(rr 
Trr 
)rr 
	Activatorrr !
.rr! "
CreateInstancerr" 0
(rr0 1
typeofrr1 7
(rr7 8
Trr8 9
)rr9 :
)rr: ;
;rr; <
returnss 
falsess 
;ss 
}tt 
Consolevv 
.vv 
	WriteLinevv 
(vv 
$strvv G
,vvG H
messagevvI P
.vvP Q
LengthvvQ W
,vvW X
typevvY ]
.vv] ^
ToStringvv^ f
(vvf g
)vvg h
.vvh i
ToUppervvi p
(vvp q
)vvq r
)vvr s
;vvs t
tryww 
{xx 
usingyy 
(yy 
MemoryStreamyy #
memoryStreamyy$ 0
=yy1 2
newyy3 6
MemoryStreamyy7 C
(yyC D
messageyyD K
)yyK L
)yyL M
{zz 
memoryStream{{  
.{{  !
Seek{{! %
({{% &
$num{{& '
,{{' (

SeekOrigin{{) 3
.{{3 4
Begin{{4 9
){{9 :
;{{: ;
sm|| 
=|| 
(|| 
T|| 
)|| 
(|| 
new||  
BinaryFormatter||! 0
(||0 1
)||1 2
)||2 3
.||3 4
Deserialize||4 ?
(||? @
memoryStream||@ L
)||L M
;||M N
}}} 
}~~ 
catch 
( 
	Exception 
ex 
)  
{
ÄÄ 
Console
ÅÅ 
.
ÅÅ 
	WriteLine
ÅÅ !
(
ÅÅ! "
$str
ÅÅ" D
+
ÅÅE F
ex
ÅÅG I
.
ÅÅI J
ToString
ÅÅJ R
(
ÅÅR S
)
ÅÅS T
,
ÅÅT U
type
ÅÅV Z
.
ÅÅZ [
ToString
ÅÅ[ c
(
ÅÅc d
)
ÅÅd e
.
ÅÅe f
ToUpper
ÅÅf m
(
ÅÅm n
)
ÅÅn o
)
ÅÅo p
;
ÅÅp q
sm
ÇÇ 
=
ÇÇ 
default
ÇÇ 
(
ÇÇ 
T
ÇÇ 
)
ÇÇ 
;
ÇÇ  
return
ÉÉ 
false
ÉÉ 
;
ÉÉ 
}
ÑÑ 
sm
ÜÜ 
=
ÜÜ 
default
ÜÜ 
(
ÜÜ 
T
ÜÜ 
)
ÜÜ 
;
ÜÜ 
return
áá 
false
áá 
;
áá 
}
àà 	
}
ââ 
public
ãã 

class
ãã !
SocketServerConsole
ãã $
{
åå 
private
çç 
readonly
çç 
Control
çç  
printer
çç! (
;
çç( )
private
èè !
SocketServerConsole
èè #
(
èè# $
)
èè$ %
{
êê 	
}
ëë 	
public
ìì !
SocketServerConsole
ìì "
(
ìì" #
Control
ìì# *
c
ìì+ ,
)
ìì, -
{
îî 	
printer
ïï 
=
ïï 
c
ïï 
;
ïï 
}
ññ 	
public
òò 
void
òò 
Log
òò 
(
òò 
string
òò 
str
òò "
,
òò" #
params
òò$ *
object
òò+ 1
[
òò1 2
]
òò2 3
str0
òò4 8
)
òò8 9
{
ôô 	
Log
öö 
(
öö 
string
öö 
.
öö 
Format
öö 
(
öö 
str
öö !
,
öö! "
str0
öö# '
)
öö' (
)
öö( )
;
öö) *
}
õõ 	
public
ùù 
void
ùù 
Log
ùù 
(
ùù 
string
ùù 
str
ùù "
)
ùù" #
{
ûû 	
Console
üü 
.
üü 
	WriteLine
üü 
(
üü 
str
üü !
)
üü! "
;
üü" #
}
©© 	
}
™™ 
public
¨¨ 

class
¨¨ !
SocketClientConsole
¨¨ $
{
≠≠ 
public
ÆÆ 
Control
ÆÆ 
errorPrinter
ÆÆ #
;
ÆÆ# $
private
∞∞ 
readonly
∞∞ 
Control
∞∞  
printer
∞∞! (
;
∞∞( )
private
±± 
readonly
±± 
bool
±± 

writeLines
±± (
=
±±) *
true
±±+ /
;
±±/ 0
private
≥≥ !
SocketClientConsole
≥≥ #
(
≥≥# $
)
≥≥$ %
{
¥¥ 	
}
µµ 	
public
∑∑ !
SocketClientConsole
∑∑ "
(
∑∑" #
Control
∑∑# *
c
∑∑+ ,
,
∑∑, -
bool
∑∑. 2
wl
∑∑3 5
=
∑∑6 7
true
∑∑8 <
)
∑∑< =
{
∏∏ 	
printer
ππ 
=
ππ 
c
ππ 
;
ππ 

writeLines
∫∫ 
=
∫∫ 
wl
∫∫ 
;
∫∫ 
}
ªª 	
public
ΩΩ 
void
ΩΩ 
Log
ΩΩ 
(
ΩΩ 
string
ΩΩ 
str
ΩΩ "
,
ΩΩ" #
params
ΩΩ$ *
object
ΩΩ+ 1
[
ΩΩ1 2
]
ΩΩ2 3
str0
ΩΩ4 8
)
ΩΩ8 9
{
ææ 	
Log
øø 
(
øø 
string
øø 
.
øø 
Format
øø 
(
øø 
str
øø !
,
øø! "
str0
øø# '
)
øø' (
)
øø( )
;
øø) *
}
¿¿ 	
public
¬¬ 
void
¬¬ 
Log
¬¬ 
(
¬¬ 
string
¬¬ 
str
¬¬ "
)
¬¬" #
{
√√ 	
if
ƒƒ 
(
ƒƒ 

writeLines
ƒƒ 
)
ƒƒ 
Console
≈≈ 
.
≈≈ 
	WriteLine
≈≈ !
(
≈≈! "
$str
≈≈" 4
+
≈≈5 6
str
≈≈7 :
)
≈≈: ;
;
≈≈; <
}
œœ 	
public
—— 
void
—— 
LogError
—— 
(
—— 
string
—— #
str
——$ '
,
——' (
params
——) /
object
——0 6
[
——6 7
]
——7 8
str0
——9 =
)
——= >
{
““ 	
LogError
”” 
(
”” 
string
”” 
.
”” 
Format
”” "
(
””" #
str
””# &
,
””& '
str0
””( ,
)
””, -
)
””- .
;
””. /
}
‘‘ 	
public
÷÷ 
void
÷÷ 
LogError
÷÷ 
(
÷÷ 
string
÷÷ #
str
÷÷$ '
)
÷÷' (
{
◊◊ 	
if
ÿÿ 
(
ÿÿ 

writeLines
ÿÿ 
)
ÿÿ 
Console
ŸŸ 
.
ŸŸ 
	WriteLine
ŸŸ !
(
ŸŸ! "
$str
ŸŸ" :
+
ŸŸ; <
str
ŸŸ= @
)
ŸŸ@ A
;
ŸŸA B
}
„„ 	
}
‰‰ 
}ÂÂ ü∂
YD:\VISUAL STUDIO\Visual Studio Projects\Prueba-Sockets-L2API\Dummy-Socket\SocketServer.cs
	namespace 	
DeltaSockets
 
{		 
public 

class 
SocketServer 
{ 
public 
SocketServerConsole "
myLogger# +
=, -
new. 1
SocketServerConsole2 E
(E F
nullF J
)J K
;K L
public 
const 
int 
minBufferSize &
=' (
$num) -
;- .
public 
const 
int 
DefPort  
=! "
$num# '
;' (
public 
Socket 
ServerSocket "
;" #
public   
SocketPermission   
	Permision    )
;  ) *
public%% 
	IPAddress%% 
IP%% 
;%% 
public** 
int** 
Port** 
;** 
private,, 
SocketState,, 
_state,, "
;,," #
public-- 
SocketState-- 
myState-- "
{.. 	
get// 
{00 
return11 
_state11 
;11 
}22 
}33 	
private55 

IPEndPoint55 
	_endpoint55 $
;55$ %
private66 
byte66 
[66 
]66 
byteData66 
=66  !
new66" %
byte66& *
[66* +
minBufferSize66+ 8
]668 9
;669 :
public;; 
static;; 
ManualResetEvent;; &
allDone;;' .
=;;/ 0
new;;1 4
ManualResetEvent;;5 E
(;;E F
false;;F K
);;K L
;;;L M
public@@ 
static@@ 

Dictionary@@  
<@@  !
int@@! $
,@@$ %
Socket@@& ,
>@@, -
routingTable@@. :
=@@; <
new@@= @

Dictionary@@A K
<@@K L
int@@L O
,@@O P
Socket@@Q W
>@@W X
(@@X Y
)@@Y Z
;@@Z [
privateBB 
readonlyBB 
staticBB 
ListBB  $
<BB$ %
intBB% (
>BB( )
closedClientsBB* 7
=BB8 9
newBB: =
ListBB> B
<BBB C
intBBC F
>BBF G
(BBG H
)BBH I
;BBI J
privateDD 
staticDD 
boolDD 
debugDD !
;DD! "
internalFF 

IPEndPointFF 
IPEndFF !
{GG 	
getHH 
{II 
ifJJ 
(JJ 
IPJJ 
!=JJ 
nullJJ 
)JJ 
{KK 
ifLL 
(LL 
	_endpointLL !
==LL" $
nullLL% )
)LL) *
	_endpointMM !
=MM" #
newMM$ '

IPEndPointMM( 2
(MM2 3
IPMM3 5
,MM5 6
PortMM7 ;
)MM; <
;MM< =
returnNN 
	_endpointNN $
;NN$ %
}OO 
elsePP 
returnPP 
nullPP  
;PP  !
}QQ 
}RR 	
publicYY 
SocketServerYY 
(YY 
boolYY  
debugYY! &
,YY& '
boolYY( ,
doConnectionYY- 9
=YY: ;
falseYY< A
)YYA B
:YYC D
thisZZ 
(ZZ 
newZZ 
SocketPermissionZZ %
(ZZ% &
NetworkAccessZZ& 3
.ZZ3 4
AcceptZZ4 :
,ZZ: ;
TransportTypeZZ< I
.ZZI J
TcpZZJ M
,ZZM N
$strZZO Q
,ZZQ R
SocketPermissionZZS c
.ZZc d
AllPortsZZd l
)ZZl m
,ZZm n
DnsZZo r
.ZZr s
GetHostEntryZZs 
(	ZZ Ä
$str
ZZÄ Ç
)
ZZÇ É
.
ZZÉ Ñ
AddressList
ZZÑ è
[
ZZè ê
$num
ZZê ë
]
ZZë í
,
ZZí ì
DefPort
ZZî õ
,
ZZõ ú

SocketType
ZZù ß
.
ZZß ®
Stream
ZZ® Æ
,
ZZÆ Ø
ProtocolType
ZZ∞ º
.
ZZº Ω
Tcp
ZZΩ ¿
,
ZZ¿ ¡
debug
ZZ¬ «
,
ZZ« »
doConnection
ZZ… ’
)
ZZ’ ÷
{[[ 	
}[[
 
publicdd 
SocketServerdd 
(dd 
stringdd "
ipdd# %
,dd% &
intdd' *
portdd+ /
,dd/ 0
booldd1 5
debugdd6 ;
,dd; <
booldd= A
doConnectionddB N
=ddO P
falseddQ V
)ddV W
:ddX Y
thisee 
(ee 
newee 
SocketPermissionee %
(ee% &
NetworkAccessee& 3
.ee3 4
Acceptee4 :
,ee: ;
TransportTypeee< I
.eeI J
TcpeeJ M
,eeM N
$streeO Q
,eeQ R
SocketPermissioneeS c
.eec d
AllPortseed l
)eel m
,eem n
	IPAddresseeo x
.eex y
Parseeey ~
(ee~ 
ip	ee Å
)
eeÅ Ç
,
eeÇ É
port
eeÑ à
,
eeà â

SocketType
eeä î
.
eeî ï
Stream
eeï õ
,
eeõ ú
ProtocolType
eeù ©
.
ee© ™
Tcp
ee™ ≠
,
ee≠ Æ
debug
eeØ ¥
,
ee¥ µ
doConnection
ee∂ ¬
)
ee¬ √
{ff 	
}ff
 
publicrr 
SocketServerrr 
(rr 
SocketPermissionrr ,

permissionrr- 7
,rr7 8
	IPAddressrr9 B
ipAddrrrC I
,rrI J
intrrK N
portrrO S
,rrS T

SocketTyperrU _
sTyperr` e
,rre f
ProtocolTyperrg s
pTyperrt y
,rry z
boolrr{ 
curDebug
rrÄ à
,
rrà â
bool
rrä é
doConnection
rrè õ
=
rrú ù
false
rrû £
)
rr£ §
{ss 	

permissiontt 
.tt 
Demandtt 
(tt 
)tt 
;tt  
IPvv 
=vv 
ipAddrvv 
;vv 
Portww 
=ww 
portww 
;ww 
debugyy 
=yy 
curDebugyy 
;yy 
ServerSocket|| 
=|| 
new|| 
Socket|| %
(||% &
ipAddr||& ,
.||, -
AddressFamily||- :
,||: ;
sType||< A
,||A B
pType||C H
)||H I
;||I J
if~~ 
(~~ 
doConnection~~ 
)~~ 
	ComeAlive 
( 
) 
; 
}
ÄÄ 	
public
ÖÖ 
void
ÖÖ 
	ComeAlive
ÖÖ 
(
ÖÖ 
)
ÖÖ 
{
ÜÜ 	
if
áá 
(
áá 
IPEnd
áá 
!=
áá 
null
áá 
)
áá 
{
àà 
try
ââ 
{
ää 
try
ãã 
{
åå 
ServerSocket
çç $
.
çç$ %
Bind
çç% )
(
çç) *
IPEnd
çç* /
)
çç/ 0
;
çç0 1
ServerSocket
éé $
.
éé$ %
Listen
éé% +
(
éé+ ,
$num
éé, .
)
éé. /
;
éé/ 0
Console
êê 
.
êê  
	WriteLine
êê  )
(
êê) *
$str
êê* G
)
êêG H
;
êêH I
ServerSocket
ëë $
.
ëë$ %
BeginAccept
ëë% 0
(
ëë0 1
new
ëë1 4
AsyncCallback
ëë5 B
(
ëëB C
OnAccept
ëëC K
)
ëëK L
,
ëëL M
ServerSocket
ëëN Z
)
ëëZ [
;
ëë[ \
}
íí 
catch
ìì 
(
ìì 
	Exception
ìì $
ex
ìì% '
)
ìì' (
{
îî 
Console
ïï 
.
ïï  
	WriteLine
ïï  )
(
ïï) *
$str
ïï* U
+
ïïV W
ex
ïïX Z
)
ïïZ [
;
ïï[ \
return
ññ 
;
ññ 
}
óó 
_state
òò 
=
òò 
SocketState
òò (
.
òò( )
ServerStarted
òò) 6
;
òò6 7
}
ôô 
catch
öö 
(
öö 
	Exception
öö  
ex
öö! #
)
öö# $
{
õõ 
Console
úú 
.
úú 
	WriteLine
úú %
(
úú% &
ex
úú& (
.
úú( )
Message
úú) 0
)
úú0 1
;
úú1 2
}
ùù 
}
ûû 
else
üü 
Console
üü 
.
üü 
	WriteLine
üü "
(
üü" #
$str
üü# B
)
üüB C
;
üüC D
}
†† 	
private
¢¢ 
void
¢¢ 
OnAccept
¢¢ 
(
¢¢ 
IAsyncResult
¢¢ *
ar
¢¢+ -
)
¢¢- .
{
££ 	
try
§§ 
{
•• 
Socket
¶¶ 
clientSocket
¶¶ #
=
¶¶$ %
ServerSocket
¶¶& 2
.
¶¶2 3
	EndAccept
¶¶3 <
(
¶¶< =
ar
¶¶= ?
)
¶¶? @
;
¶¶@ A
ServerSocket
©© 
.
©© 
BeginAccept
©© (
(
©©( )
new
©©) ,
AsyncCallback
©©- :
(
©©: ;
OnAccept
©©; C
)
©©C D
,
©©D E
null
©©F J
)
©©J K
;
©©K L
clientSocket
¨¨ 
.
¨¨ 
BeginReceive
¨¨ )
(
¨¨) *
byteData
¨¨* 2
,
¨¨2 3
$num
¨¨4 5
,
¨¨5 6
byteData
¨¨7 ?
.
¨¨? @
Length
¨¨@ F
,
¨¨F G
SocketFlags
¨¨H S
.
¨¨S T
None
¨¨T X
,
¨¨X Y
new
≠≠ 
AsyncCallback
≠≠ %
(
≠≠% &
	OnReceive
≠≠& /
)
≠≠/ 0
,
≠≠0 1
clientSocket
≠≠2 >
)
≠≠> ?
;
≠≠? @
}
ÆÆ 
catch
ØØ 
(
ØØ 
	Exception
ØØ 
ex
ØØ 
)
ØØ  
{
∞∞ 
Console
±± 
.
±± 
	WriteLine
±± !
(
±±! "
$str
±±" W
+
±±X Y
ex
±±Z \
.
±±\ ]
Message
±±] d
)
±±d e
;
±±e f
}
≤≤ 
}
≥≥ 	
private
µµ 
void
µµ 
	OnReceive
µµ 
(
µµ 
IAsyncResult
µµ +
ar
µµ, .
)
µµ. /
{
∂∂ 	
try
∑∑ 
{
∏∏ 
Socket
ππ 
handler
ππ 
=
ππ  
(
ππ! "
Socket
ππ" (
)
ππ( )
ar
ππ) +
.
ππ+ ,

AsyncState
ππ, 6
;
ππ6 7
int
∫∫ 
	bytesRead
∫∫ 
=
∫∫ 
handler
∫∫  '
.
∫∫' (

EndReceive
∫∫( 2
(
∫∫2 3
ar
∫∫3 5
)
∫∫5 6
;
∫∫6 7
SocketMessage
ºº 
sm
ºº  
=
ºº! "
null
ºº# '
;
ºº' (
bool
ΩΩ 

serialized
ΩΩ 
=
ΩΩ  !
SocketManager
ΩΩ" /
.
ΩΩ/ 0
Deserialize
ΩΩ0 ;
(
ΩΩ; <
byteData
ΩΩ< D
,
ΩΩD E
out
ΩΩF I
sm
ΩΩJ L
,
ΩΩL M
SocketDbgType
ΩΩN [
.
ΩΩ[ \
Server
ΩΩ\ b
)
ΩΩb c
;
ΩΩc d
if
øø 
(
øø 
	bytesRead
øø 
>
øø 
$num
øø  !
&&
øø" $
	bytesRead
øø% .
<
øø/ 0
minBufferSize
øø1 >
)
øø> ?
{
¿¿ 
Console
¬¬ 
.
¬¬ 
	WriteLine
¬¬ %
(
¬¬% &
$str
¬¬& H
,
¬¬H I
	bytesRead
¬¬J S
)
¬¬S T
;
¬¬T U
if
ƒƒ 
(
ƒƒ 
sm
ƒƒ 
!=
ƒƒ 
null
ƒƒ "
)
ƒƒ" #
{
≈≈ 
if
∆∆ 
(
∆∆ 
sm
∆∆ 
.
∆∆ 

TypeString
∆∆ )
==
∆∆* ,
typeof
∆∆- 3
(
∆∆3 4
string
∆∆4 :
)
∆∆: ;
.
∆∆; <
Name
∆∆< @
)
∆∆@ A
DoStringAction
«« *
(
««* +
sm
««+ -
,
««- .
handler
««/ 6
)
««6 7
;
««7 8
else
»» 
DoServerError
…… )
(
……) *
$str
……* ?
)
……? @
;
……@ A
}
   
else
ÀÀ 
{
ÃÃ 
if
ÕÕ 
(
ÕÕ 

serialized
ÕÕ &
)
ÕÕ& '
myLogger
ŒŒ $
.
ŒŒ$ %
Log
ŒŒ% (
(
ŒŒ( )
$str
ŒŒ) Z
)
ŒŒZ [
;
ŒŒ[ \
else
œœ 
DoServerError
–– )
(
––) *
$str
––* ?
)
––? @
;
––@ A
}
—— 
}
““ 
else
”” 
if
”” 
(
”” 
	bytesRead
”” "
>
””# $
minBufferSize
””% 2
)
””2 3
{
‘‘ 
Console
◊◊ 
.
◊◊ 
	WriteLine
◊◊ %
(
◊◊% &
$str
◊◊& Q
,
◊◊Q R
	bytesRead
◊◊S \
)
◊◊\ ]
;
◊◊] ^ 
SendToOtherClients
ÿÿ &
(
ÿÿ& '
sm
ÿÿ' )
,
ÿÿ) *
	bytesRead
ÿÿ+ 4
)
ÿÿ4 5
;
ÿÿ5 6
byteData
ŸŸ 
=
ŸŸ 
new
ŸŸ "
byte
ŸŸ# '
[
ŸŸ' (
minBufferSize
ŸŸ( 5
]
ŸŸ5 6
;
ŸŸ6 7
}
⁄⁄ 
handler
›› 
.
›› 
BeginReceive
›› $
(
››$ %
byteData
››% -
,
››- .
$num
››/ 0
,
››0 1
byteData
››2 :
.
››: ;
Length
››; A
,
››A B
SocketFlags
››C N
.
››N O
None
››O S
,
››S T
new
ﬁﬁ 
AsyncCallback
ﬁﬁ %
(
ﬁﬁ% &
	OnReceive
ﬁﬁ& /
)
ﬁﬁ/ 0
,
ﬁﬁ0 1
handler
ﬁﬁ2 9
)
ﬁﬁ9 :
;
ﬁﬁ: ;
}
ﬂﬂ 
catch
‡‡ 
(
‡‡ 
	Exception
‡‡ 
ex
‡‡ 
)
‡‡  
{
·· 
Console
‚‚ 
.
‚‚ 
	WriteLine
‚‚ !
(
‚‚! "
ex
‚‚" $
.
‚‚$ %
Message
‚‚% ,
)
‚‚, -
;
‚‚- .
}
„„ 
}
‰‰ 	
private
ÊÊ 
void
ÊÊ 
DoStringAction
ÊÊ #
(
ÊÊ# $
SocketMessage
ÊÊ$ 1
sm
ÊÊ2 4
,
ÊÊ4 5
Socket
ÊÊ6 <
handler
ÊÊ= D
)
ÊÊD E
{
ÁÁ 	
switch
ËË 
(
ËË 
sm
ËË 
.
ËË 
StringValue
ËË "
)
ËË" #
{
ÈÈ 
case
ÍÍ 
$str
ÍÍ 
:
ÍÍ 
routingTable
ÎÎ  
.
ÎÎ  !
Add
ÎÎ! $
(
ÎÎ$ %
sm
ÎÎ% '
.
ÎÎ' (
id
ÎÎ( *
,
ÎÎ* +
handler
ÎÎ, 3
)
ÎÎ3 4
;
ÎÎ4 5
break
ÏÏ 
;
ÏÏ 
case
ÌÌ 
$str
ÌÌ &
:
ÌÌ& '
CloseAllClients
ÓÓ #
(
ÓÓ# $
)
ÓÓ$ %
;
ÓÓ% &
break
ÔÔ 
;
ÔÔ 
case
 
$str
 &
:
& '
closedClients
ÒÒ !
.
ÒÒ! "
Add
ÒÒ" %
(
ÒÒ% &
sm
ÒÒ& (
.
ÒÒ( )
id
ÒÒ) +
)
ÒÒ+ ,
;
ÒÒ, -*
CloseServerAfterClientsClose
ÚÚ 0
(
ÚÚ0 1
)
ÚÚ1 2
;
ÚÚ2 3
break
ÛÛ 
;
ÛÛ 
case
ÙÙ 
$str
ÙÙ 
:
ÙÙ 
CloseAllClients
ıı #
(
ıı# $
)
ıı$ %
;
ıı% &
break
ˆˆ 
;
ˆˆ 
case
˜˜ 
$str
˜˜ &
:
˜˜& '
Stop
¯¯ 
(
¯¯ 
)
¯¯ 
;
¯¯ 
break
˘˘ 
;
˘˘ 
default
˙˙ 
:
˙˙ 
string
˚˚ 
blockSizeId
˚˚ &
=
˚˚' (
$str
˚˚) 6
;
˚˚6 7
if
¸¸ 
(
¸¸ 
sm
¸¸ 
.
¸¸ 
StringValue
¸¸ &
.
¸¸& '

StartsWith
¸¸' 1
(
¸¸1 2
blockSizeId
¸¸2 =
)
¸¸= >
)
¸¸> ?
{
˝˝ 
int
˛˛ 
bytesToRead
˛˛ '
=
˛˛( )
int
˛˛* -
.
˛˛- .
Parse
˛˛. 3
(
˛˛3 4
sm
˛˛4 6
.
˛˛6 7
StringValue
˛˛7 B
.
˛˛B C
	Substring
˛˛C L
(
˛˛L M
blockSizeId
˛˛M X
.
˛˛X Y
Length
˛˛Y _
-
˛˛` a
$num
˛˛b c
)
˛˛c d
)
˛˛d e
;
˛˛e f
Console
ÄÄ 
.
ÄÄ  
	WriteLine
ÄÄ  )
(
ÄÄ) *
$str
ÄÄ* b
,
ÄÄb c
bytesToRead
ÄÄd o
)
ÄÄo p
;
ÄÄp q
byteData
ÇÇ  
=
ÇÇ! "
new
ÇÇ# &
byte
ÇÇ' +
[
ÇÇ+ ,
bytesToRead
ÇÇ, 7
]
ÇÇ7 8
;
ÇÇ8 9
}
ÉÉ 
else
ÑÑ 
DoServerError
ÖÖ %
(
ÖÖ% &
$str
ÖÖ& F
)
ÖÖF G
;
ÖÖG H
break
ÜÜ 
;
ÜÜ 
}
áá 
}
àà 	
private
ää 
void
ää 
CloseAllClients
ää $
(
ää$ %
)
ää% &
{
ãã 	
foreach
çç 
(
çç 
KeyValuePair
çç !
<
çç! "
int
çç" %
,
çç% &
Socket
çç' -
>
çç- .
soc
çç/ 2
in
çç3 5
routingTable
çç6 B
)
ççB C
soc
èè 
.
èè 
Value
èè 
.
èè 
Send
èè 
(
èè 
Encoding
èè '
.
èè' (
Unicode
èè( /
.
èè/ 0
GetBytes
èè0 8
(
èè8 9
$str
èè9 B
)
èèB C
)
èèC D
;
èèD E
}
êê 	
private
íí 
void
íí *
CloseServerAfterClientsClose
íí 1
(
íí1 2
)
íí2 3
{
ìì 	
if
îî 
(
îî 
closedClients
îî 
.
îî 
Count
îî #
==
îî$ &
routingTable
îî' 3
.
îî3 4
Count
îî4 9
)
îî9 :
Stop
ïï 
(
ïï 
)
ïï 
;
ïï 
}
ññ 	
private
òò 
void
òò 
DoServerError
òò "
(
òò" #
string
òò# )
msg
òò* -
)
òò- .
{
ôô 	

PoliteStop
öö 
(
öö 
)
öö 
;
öö 
Console
õõ 
.
õõ 
	WriteLine
õõ 
(
õõ 
$str
õõ 7
+
õõ8 9
msg
õõ: =
)
õõ= >
;
õõ> ?
}
úú 	
private
ûû 
void
ûû  
SendToOtherClients
ûû '
(
ûû' (
SocketMessage
ûû( 5
sm
ûû6 8
,
ûû8 9
int
ûû: =
	bytesRead
ûû> G
)
ûûG H
{
üü 	
myLogger
†† 
.
†† 
Log
†† 
(
†† 
$str
†† 6
)
††6 7
;
††7 8
myLogger
°° 
.
°° 
Log
°° 
(
°° 
$str
°° D
,
°°D E
sm
°°F H
.
°°H I
id
°°I K
,
°°K L
	bytesRead
°°M V
)
°°V W
;
°°W X
myLogger
¢¢ 
.
¢¢ 
Log
¢¢ 
(
¢¢ 
$str
¢¢ 8
)
¢¢8 9
;
¢¢9 :
myLogger
££ 
.
££ 
Log
££ 
(
££ 
$str
££ 6
)
££6 7
;
££7 8
myLogger
§§ 
.
§§ 
Log
§§ 
(
§§ 
$str
§§ 
)
§§ 
;
§§ 
foreach
ßß 
(
ßß 
KeyValuePair
ßß !
<
ßß! "
int
ßß" %
,
ßß% &
Socket
ßß' -
>
ßß- .
soc
ßß/ 2
in
ßß3 5
routingTable
ßß6 B
)
ßßB C
if
®® 
(
®® 
soc
®® 
.
®® 
Key
®® 
!=
®® 
sm
®® !
.
®®! "
id
®®" $
)
®®$ %
soc
©© 
.
©© 
Value
©© 
.
©© 
Send
©© "
(
©©" #
byteData
©©# +
)
©©+ ,
;
©©, -
}
™™ 	
public
∞∞ 
void
∞∞ 
OnSend
∞∞ 
(
∞∞ 
IAsyncResult
∞∞ '
ar
∞∞( *
)
∞∞* +
{
±± 	
try
≤≤ 
{
≥≥ 
Socket
¥¥ 
client
¥¥ 
=
¥¥ 
(
¥¥  !
Socket
¥¥! '
)
¥¥' (
ar
¥¥( *
.
¥¥* +

AsyncState
¥¥+ 5
;
¥¥5 6
client
µµ 
.
µµ 
EndSend
µµ 
(
µµ 
ar
µµ !
)
µµ! "
;
µµ" #
}
∂∂ 
catch
∑∑ 
(
∑∑ 
	Exception
∑∑ 
ex
∑∑ 
)
∑∑  
{
∏∏ 
Console
ππ 
.
ππ 
	WriteLine
ππ !
(
ππ! "
ex
ππ" $
.
ππ$ %
Message
ππ% ,
)
ππ, -
;
ππ- .
}
∫∫ 
}
ªª 	
public
ΩΩ 
void
ΩΩ 

PoliteStop
ΩΩ 
(
ΩΩ 
)
ΩΩ  
{
ææ 	
CloseAllClients
øø 
(
øø 
)
øø 
;
øø 
}
¿¿ 	
private
≈≈ 
void
≈≈ 
Stop
≈≈ 
(
≈≈ 
)
≈≈ 
{
∆∆ 	
if
«« 
(
«« 
_state
«« 
==
«« 
SocketState
«« %
.
««% &
ServerStarted
««& 3
)
««3 4
{
»» 
try
…… 
{
   
Console
ÀÀ 
.
ÀÀ 
	WriteLine
ÀÀ %
(
ÀÀ% &
$str
ÀÀ& 6
)
ÀÀ6 7
;
ÀÀ7 8
_state
ÕÕ 
=
ÕÕ 
SocketState
ÕÕ (
.
ÕÕ( )
ServerStopped
ÕÕ) 6
;
ÕÕ6 7
if
ŒŒ 
(
ŒŒ 
ServerSocket
ŒŒ $
.
ŒŒ$ %
	Connected
ŒŒ% .
)
ŒŒ. /
ServerSocket
œœ $
.
œœ$ %
Shutdown
œœ% -
(
œœ- .
SocketShutdown
œœ. <
.
œœ< =
Both
œœ= A
)
œœA B
;
œœB C
ServerSocket
––  
.
––  !
Close
––! &
(
––& '
)
––' (
;
––( )
}
—— 
catch
““ 
(
““ 
	Exception
““  
ex
““! #
)
““# $
{
”” 
Console
‘‘ 
.
‘‘ 
	WriteLine
‘‘ %
(
‘‘% &
$str
‘‘& W
+
‘‘X Y
ex
‘‘Z \
)
‘‘\ ]
;
‘‘] ^
}
’’ 
}
÷÷ 
else
◊◊ 
Console
ÿÿ 
.
ÿÿ 
	WriteLine
ÿÿ !
(
ÿÿ! "
$str
ÿÿ" \
)
ÿÿ\ ]
;
ÿÿ] ^
}
ŸŸ 	
public
€€ 
void
€€ 
Dispose
€€ 
(
€€ 
)
€€ 
{
‹‹ 	
Console
›› 
.
›› 
	WriteLine
›› 
(
›› 
$str
›› 0
)
››0 1
;
››1 2
Stop
ﬁﬁ 
(
ﬁﬁ 
)
ﬁﬁ 
;
ﬁﬁ 
}
ﬂﬂ 	
}
‡‡ 
}·· 